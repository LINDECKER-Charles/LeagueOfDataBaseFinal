{% extends 'base.html.twig' %}

{% block title %}{{ item.name ?? 'Item' }}{% endblock %}

{% block body %}
<main class="relative min-h-[65vh] bg-blue-950 overflow-hidden flex items-center justify-center py-7 w-full">

  {% include 'partials/visual/gradient.html.twig' %}

  {% set selectedVersion = client.session.version ?? (client.versions|default([])|first) %}
  {% set selectedLocale  = client.session.locale  ?? client.currentLocale ?? 'en_US' %}

  <div class="relative mx-auto max-w-5xl">

    {# --- En-tête --- #}
    <article class="mb-10 flex items-center gap-6">
      {% if image %}
        <div class="relative shrink-0 h-20 w-20 rounded-2xl bg-blue-950 border border-grey-700 grid place-items-center overflow-hidden">
          <img src="/{{ image }}" alt="{{ item.name }}" class="h-16 w-16 object-contain transition group-hover:scale-105 duration-300">
        </div>
      {% else %}
        <div class="h-20 w-20 rounded-2xl grid place-items-center bg-blue-950 border border-grey-700 text-blue-200/70 text-lg">
          {{ item.name|slice(0,2)|upper }}
        </div>
      {% endif %}

      <section>
        <h1 class="font-beaufort text-4xl tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-blue-100 via-blue-300 to-blue-100">
          {{ item.name ?? 'Item' }}
        </h1>
        <p class="font-spiegel text-blue-200/80 mt-1">
          {{ item.plaintext ?? '' }}
        </p>
        <p class="mt-1 text-sm text-blue-200/60">
          Version : {{ selectedVersion }} — Langue : {{ selectedLocale }}
        </p>
      </section>
    </article>

    {# --- Infos principales --- #}
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
      <div class="rounded-lg bg-blue-950/80 p-4 border border-grey-700">
        <dt class="text-blue-200/70 text-sm">Prix total</dt>
        <dd class="font-medium text-white/90">{{ item.gold.total ?? '–' }}</dd>
      </div>
      <div class="rounded-lg bg-blue-950/80 p-4 border border-grey-700">
        <dt class="text-blue-200/70 text-sm">Prix d'achat</dt>
        <dd class="font-medium text-white/90">{{ item.gold.base ?? '–' }}</dd>
      </div>
      <div class="rounded-lg bg-blue-950/80 p-4 border border-grey-700">
        <dt class="text-blue-200/70 text-sm">Revente</dt>
        <dd class="font-medium text-white/90">{{ item.gold.sell ?? '–' }}</dd>
      </div>
    </div>

    {# --- Catégories / tags --- #}
    {% if item.tags is defined and item.tags is iterable and item.tags is not empty %}
      <section class="mb-8">
        <h2 class="text-lg font-semibold text-white mb-3">Catégories</h2>
        <div class="flex flex-wrap gap-2">
          {% for tag in item.tags %}
            <span class="rounded-full bg-blue-950/70 px-3 py-1 text-sm border border-grey-700 text-blue-200/90">{{ tag }}</span>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    {# --- Évolutions possibles --- #}
    {% if item.into is defined and item.into is iterable and item.into is not empty %}
      <section class="mb-8">
        <h2 class="text-lg font-semibold text-white mb-3">Évolutions possibles</h2>
        <div class="flex flex-wrap gap-3">
          {% for child in item.into %}
            {% set childImg = images[child]|default(null) %}
            <div class="flex items-center gap-2">
              {% if childImg %}
                <img src="/{{ childImg }}" alt="Item {{ child }}" class="h-8 w-8 object-contain rounded border border-grey-700">
              {% endif %}
              <span class="text-sm text-blue-200/90">{{ child }}</span>
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    {# --- Stats --- #}
    {% if item.stats is defined and item.stats is not empty %}
      <section class="mb-8">
        <h2 class="text-lg font-semibold text-white mb-3">Statistiques</h2>
        <ul class="space-y-2 text-sm text-blue-100/90">
          {% for key, val in item.stats %}
            <li><span class="text-blue-200/70">{{ key }} :</span> {{ val }}</li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}

    {# --- Description complète --- #}
    {% if item.description is defined and item.description %}
      <section>
        <h2 class="text-lg font-semibold text-white mb-3">Description</h2>
        <div class="prose prose-invert max-w-none text-blue-100/90">
          {{ item.description|raw }}
        </div>
      </section>
    {% endif %}

    {# --- Actions --- #}
    <div class="mt-10 flex gap-4">
      <a href="{{ path('app_items') }}"
         class="px-4 py-2 rounded-lg border border-grey-700 bg-transparent text-white hover:bg-blue-900 transition">
        ← Retour à la liste
      </a>
      <a href="{{ path('app_setup') }}"
         class="px-4 py-2 rounded-lg border border-grey-700 bg-blue-200 text-blue-950 font-semibold hover:bg-blue-100 transition">
        Changer version & langue
      </a>
    </div>

  </div>
</main>
{% endblock %}
